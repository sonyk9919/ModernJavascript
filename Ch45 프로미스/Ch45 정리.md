# 비동기 처리를 위한 콜백 패턴의 단점

비동기 함수를 호출하면 내부의 비동기로 동작하는 코드가 완료되지 않았다고 해도 종료된다. 따라서 비동기로 동작하는 코드에서 처리 결과를 외부로 반환하거나 상위 스코프의 변수에 할당하면 기대한 대로 동작하지 않는다.

```
let get = 0;

setTimeout(() => {get = 100}, 0);

console.log(get) // 100이 아닌 0을 출력한다.
```

## 콜백 헬

비동기 처리 결과에 대한 후속 처리를 수행하는 비동기 함수가 비동기 처리 결과를 가지고 또다시 비동기 함수를 호출해야 한다면 콜백 함수 호출이 중첩되어 복잡도가 높아지는 현상이 발생하는데, 이를 **콜백 헬**이라 한다.

```
get(`${url}/posts/1`, ({userId}) => {
    console.log(userId);

    get(`${url}/users/${userId}`, userInfo => {
        console.log(userInfo);
    })
})


get(`/step1`, a => {
    get(`/step2/${a}`, b => {
        get(`/step3/${b}` => {
            get(`/step4/${c}` d => {
                console.log(d);
            })
        })
    })
})
```

## 마이크로태스크 큐

프로미스의 후속 처리 메서드의 콜백 함수는 태스크 큐가 아닌 마이크로태스크 큐에 저장되며, 마이크로태스크 큐는 태스크 큐보다 우선순위가 높다.

## fetch

fetch 함수는 HTTP 응답을 나타내는 Response 객체를 래핑한 Promise 객체를 반환한다. fetch는 네트워크 오프라인, CORS 에러에만 반응할 뿐 이외의 에러는 전부 catch하지 않는다.
